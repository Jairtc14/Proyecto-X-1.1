<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SORTECH-EC</title>
  <link rel="stylesheet" href="css/estilos.css">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    /* Inline styles for the button to reduce the number of style attributes */
    .btn-comprar {
      display: inline-block;
      padding: 15px 30px;
      font-size: 18px;
      background-color: #4caf50;
      color: white;
      text-decoration: none;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    .btn-comprar:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>

<header>
  <a href="login.html">
    <img src="img/logo-sortech.png" alt="Logo Sortech" class="logo-sortech">
  </a>
</header>

<nav>
  <ul>
    <li><a href="index.html">Inicio</a></li>
    <li><a href="proyectos.html">Proyectos</a></li>
    <li><a href="contacto.html">Contacto</a></li>
  </ul>
</nav>

<main>
  <h2 class="texto-centrado">Juega</h2>
  <p class="texto-centrado">Iphone 13 128GB</p>
  <img src="img/actividad1.png" alt="actividad1" class="imagen-inicio">
  <h2 class="texto-centrado2">¬°CUPOS LIMITADOS!</h2>
  <p class="texto-centrado3">¬°N√∫meros Asignados!</p>
  <div class="barra-contenedor">
    <div class="barra-progreso">0.00%</div>
  </div>
  <p class="texto-centrado4">üìå El dispositivo se sortear√° una vez se hayan vendido todos los n√∫meros, es decir, cuando la barra de progreso alcance el 100%.</p>
  <p class="texto-centrado4">üéØ El ganador ser√° determinado tomando los 3 √∫ltimos d√≠gitos de la Suertuda Nacional (programa oficial de la Loter√≠a Nacional).</p>
</main>

<section class="como-participar">
  <h3>¬øC√≥mo participar?</h3>
  <ol>
    <li>Selecciona el combo de n√∫meros que desees.</li>
    <li>Ser√°s redirigido a una p√°gina donde seleccionar√°s tu m√©todo de pago.</li>
    <li>Una vez realizado el pago, autom√°ticamente y de forma aleatoria se asignar√°n tus n√∫meros.</li>
    <li>Revisa el correo electr√≥nico registrado en la pesta√±a de pago, all√≠ estar√°n tus n√∫meros.</li>
  </ol>
</section>

<div id="mensaje-completo" style="display: none; text-align: center; font-size: 20px; font-weight: bold; margin-top: 20px; color: red;">
  üéâ ¬°Todos los n√∫meros han sido vendidos!
</div>

<div id="seccion-combos">
  <h3 class="texto-centrado3">¬°Adquiere tus n√∫meros!</h3>
  <p class="texto-centrado3">Valor por unidad $2</p>

  <div class="fila-combos">
    <div class="combo-card" data-combo="2">
      <h4>x2 n√∫meros</h4>
      <p>$4 (a $2 c/u)</p>
      <a href="#" class="btn-comprar">Comprar</a>
    </div>
    <div class="combo-card" data-combo="3">
      <h4>x3 n√∫meros</h4>
      <p>$6 (a $2 c/u)</p>
      <a href="#" class="btn-comprar">Comprar</a>
    </div>
    <div class="combo-card" data-combo="5">
      <h4>x5 n√∫meros</h4>
      <p>$10 (a $2 c/u)</p>
      <a href="#" class="btn-comprar">Comprar</a>
    </div>
    <div class="combo-card" data-combo="10">
      <h4>x10 n√∫meros</h4>
      <p>$20 (a $2 c/u)</p>
      <a href="#" class="btn-comprar">Comprar</a>
    </div>
    <div class="combo-card" data-combo="15">
      <h4>x15 n√∫meros</h4>
      <p>$30 (a $2 c/u)</p>
      <a href="#" class="btn-comprar">Comprar</a>
    </div>
    <div class="combo-card" data-combo="20">
      <h4>x20 n√∫meros</h4>
      <p>$40 (a $2 c/u)</p>
      <a href="#" class="btn-comprar">Comprar</a>
    </div>
  </div>

  <div class="extra-card">
    <h4>¬øM√°s n√∫meros?</h4>
    <p>Agrega la cantidad de n√∫meros que desees.</p>
    <div class="extra-input">
      <input type="number" id="cantidad-numeros" min="20" max="200" placeholder="Ej: 25">
      <button class="btn-comprar" onclick="redirigirCompra()">Comprar</button>
    </div>
    <p id="mensaje-error" style="color: red; margin-top: 10px; display: none;"></p>
  </div>
</div>

<div style="text-align: center; margin-top: 40px; margin-bottom: 60px;">
  <a href="misnumeros.html" class="btn-comprar">üîç Consultar mis n√∫meros</a>
</div>

<footer>
  <p>&copy; 2025 Sortech-ec. Todos los derechos reservados.</p>
</footer>

<script>
  async function animarBarraProgreso(valorFinal) {
    const barra = document.querySelector(".barra-progreso");
    let actual = 0;

    valorFinal = Math.min(Math.max(valorFinal, 0), 100);
    barra.style.width = "0%";
    barra.textContent = "0.00%";
    barra.style.justifyContent = actual === 0 ? "center" : "flex-end";
    barra.style.paddingLeft = "0";
    barra.style.paddingRight = actual === 0 ? "0" : "10px";

    const animar = setInterval(() => {
      if (actual >= valorFinal) {
        clearInterval(animar);
      } else {
        actual += valorFinal / 100; // Incremento proporcional para suavidad
        if (actual > valorFinal) actual = valorFinal; // No exceder el valor final
        
        barra.style.width = actual + "%";
        barra.textContent = actual.toFixed(2) + "%";
        barra.style.backgroundColor = actual < 40 ? "#f44336" : actual < 70 ? "#ffc107" : "#4caf50";
        barra.style.color = actual < 40 ? "#fff" : actual < 70 ? "#000" : "#fff";
        
        // El texto se mueve con la barra - al inicio centrado, luego al final de la barra
        if (actual <= 5) {
          barra.style.justifyContent = "center";
          barra.style.paddingLeft = "0";
          barra.style.paddingRight = "0";
        } else {
          barra.style.justifyContent = "flex-end";
          barra.style.paddingLeft = "0";
          barra.style.paddingRight = "10px";
        }
      }
    }, 20);
  }

  async function obtenerYAnimarBarra() {
    const barra = document.querySelector(".barra-progreso");
    try {
      const res = await fetch("https://backend-proyecto-x.onrender.com/progreso");
      const data = await res.json();
      const porcentaje = Math.round((data.totalNumeros || 0) / 1000 * 100);
      animarBarraProgreso(porcentaje);
      if (porcentaje >= 100) {
        document.getElementById("seccion-combos").style.display = "none";
        document.getElementById("mensaje-completo").style.display = "block";
      }
    } catch (err) {
      console.error("Error al obtener progreso:", err);
      barra.textContent = "Error";
      barra.style.backgroundColor = "#999";
    }
  }

  function redirigirCompra() {
    const input = document.getElementById("cantidad-numeros");
    const mensaje = document.getElementById("mensaje-error");
    const valor = parseInt(input.value);

    if (isNaN(valor) || valor < 20 || valor > 200) {
      mensaje.textContent = "La cantidad debe ser entre 20 y 200.";
      mensaje.style.display = "block";
    } else {
      mensaje.style.display = "none";
      const producto = document.querySelector(".texto-centrado + p").textContent.trim();
      localStorage.setItem("productoSeleccionado", producto);
      localStorage.setItem("comboSeleccionado", valor);
      window.location.href = `pago.html?combo=${valor}`;
    }
  }

  document.querySelectorAll('.combo-card').forEach(card => {
    card.querySelector('.btn-comprar').addEventListener('click', () => {
      const combo = card.dataset.combo;
      const producto = document.querySelector(".texto-centrado + p").textContent.trim();
      localStorage.setItem("productoSeleccionado", producto);
      localStorage.setItem("comboSeleccionado", combo);
      window.location.href = `pago.html?combo=${combo}`;
    });
  });

  // Escuchar mensajes de otras ventanas (p√°gina admin)
  window.addEventListener('message', (event) => {
    if (event.data && event.data.tipo === 'actualizarBarra') {
      obtenerYAnimarBarra();
    }
  });

  // Verificar si hubo una actualizaci√≥n reciente al cargar la p√°gina
  window.addEventListener("DOMContentLoaded", () => {
    // SIEMPRE actualizar la barra al cargar la p√°gina
    obtenerYAnimarBarra();
    
    // Tambi√©n verificar actualizaciones recientes para sincronizaci√≥n
    const ultimaActualizacion = localStorage.getItem('ultimaActualizacionBarra');
    if (ultimaActualizacion) {
      localStorage.removeItem('ultimaActualizacionBarra'); // Limpiar despu√©s de cargar
    }
  });
</script>

</body>
</html>
